# 5장 오차역전파법

`오차역전파법`은 가중치 매개변수의 기울기를 효율적으로 계산하는 방법이다.

## 5.1 계산 그래프

`계산그래프`는 계산 과정을 그래프로 나타낸 것이다. 여기서 `그래프`는 자료구조의 그래프로 복수의`노드`와 `에지`로 표현된다.

### 5.1.1. 계산 그래프로 풀다

계산 그래프가 어떤 것인지 알기 위해 간단한 문제를 풀어보자

> 문제 1 : 현빈 군은 슈퍼에서 1개에 100원인 사과를 2개 샀습니다. 이때 지불 금액을 구하세요. 단, 소비세가 10% 부과됩니다.

> 문제1의 계산그래프

<img src="5장_오차역전파법.assets/fig 5-1.png">

> 사과의 개수와 소비세를 변수 취급한 계산그래프

<img src="5장_오차역전파법.assets/fig 5-2.png">

> 문제 2 : 현빈 군은 슈퍼엣 ㅓ사과를 2개, 귤을 3개 샀습니다. 사과는 1개에 100원, 귤을 1개 150원입니다. 소비세가 10%일 때 지불 금액을 구하세요.

> 문제2의 계산그래프

<img src="5장_오차역전파법.assets/fig 5-3.png">

`계산그래프`를 이용한 문제풀이의 흐름

1. 계산그래프를 구성한다.
2. 그래프에서 계산을 왼쪽에서 오른쪽으로 진행한다.

여기서 `계산을 왼쪽에서 오른쪽으로 진행`하는 단계를 `순전파`라고 한다. 그리고 반대 방향의 흐름을 `역전파`라고 한다.

### 5.1.2 국소적 계산

계산그래프의 특징은 `국소적 계산`을 전파함으로써 최종 결과를 얻는다는 점이다. 국소적이란 `자신과 직접 관계된 작은 범위`라는 뜻이다.

예를들어 사과 2개를 포함한 여러 식품을 구입하는 경우를 보자.

<img src="5장_오차역전파법.assets/fig 5-4.png">

여기서 핵심은 각 `노드`에서의 계산은 국소적 계산이라는 점이다. 사과와 그 외의 물풀 값을 더하는 계산에서 4000은 어떻게 계산되었는지는 상관없이 단지 두 숫자`4000,200`을 더하면 된다는 뜻이다.

이처럼 계산그래프는 `국소적 계산`에 집중함으로써 전체의 복잡한 계산을 해낼 수 있다.

### 5.1.3 왜 계산 그래프로 푸는가?

> 계산그래프의 이점

1. `국소적 계산` : 아무리 복잡해도 각 노드에서는 단순한 계산에 집중해서 문제를 단순화 할 수 있다.
2. 중간 계산 결과를 모두 보관할 수 있다.
3. 역전파를 통해 `미분`를 효율적으로 계산할 수 있다.

가령 문제1에서 사과 가교ㅕㄱ이 오르면 최종 금액에 어떤 영향을 끼치는지를 알고 싶다는 것은 `사과 가격에 대한 지불 금액의 미분`을 구하는 것과 동일하다.

<img src="5장_오차역전파법.assets/fig 5-5.png">

## 5.2 연쇄법칙

`역전파`는 `국소적인 미분`을 순방향과는 반대로 전달한다. 또한, `국소적 미분`을 전달하는 원리는 `연쇄법칙`에 따른다.

### 5.2.1 계산 그래프의 역전파

> 역전파의 예시 그림

<img src="5장_오차역전파법.assets/fig 5-6.png">

위 그림에서 역전파의 계산 절차는 신호 E에 노드의 국소적미분을 곱한 후 다음 노드로 전달하는 것이다.

여기서 국소적 미분은 x`입력`에 대한 y`출력`의 미분을 뜻한다. 그리고 이 국소적 미분을 사류에서 전달된 값`E`에 곱해 앞쪽 노드로 전달한다.

`입력의 변화에 따라 출력이 어떻게 변화하나? -> 기울기(미분)`

### 5.2.2 연쇄법칙?

연쇄법칙을 설명하기 위해서는 합성함수의 이해가 필요하다. `합성함수`란 여러 함수로 구성된 함수이다.

예를 들어 z = (x+y)^2는 

<img src="5장_오차역전파법.assets/e 5.1.png">

로 표현가능하다.

연쇄법칙은 합성 함수의 미분에 대한 성질이며

> 합성 함수의 미분은 합성 함수를 구성하는 각 함수의 미분의 곱으로 나타낼 수 있다.

로 정의 된다.

### 5.2.3 연쇄법칙과 계산 그래프



## 5.3 역전파

### 5.3.1 덧셈 노드의 역전파

> z = x + y 의 미분의 해석과 계산 그래프

<img src="5장_오차역전파법.assets/e 5.5.png">

<img src="5장_오차역전파법.assets/fig 5-9.png">

그림과 같이 역전파 때는 상류에서 전해진 미분에 1을 곱하여 하류로 흘린다. 즉, `덧셈 노드`의 역전파는 1을 곱하기만 할 뿐이고, 입력된 값을 그대로 다음 노드로 보낸다.

### 5.3.2 곱셈 노드의 역전파

> z = xy 의 미분의 해석과 계산 그래프

<img src="5장_오차역전파법.assets/e 5.6.png">

<img src="5장_오차역전파법.assets/fig 5-12.png">

`곱셈 노드`역전파는 상류의 값에 순전파 때의 입력신호들을 `서로 바꾼 값`을 곱해서 하류로 보낸다.

### 5.3.3 사과 쇼핑의 예

<img src="5장_오차역전파법.assets/fig 5-14.png">